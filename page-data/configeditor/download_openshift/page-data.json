{"componentChunkName":"component---src-pages-configeditor-download-openshift-md","path":"/configeditor/download_openshift/","result":{"pageContext":{"frontmatter":{"title":"Download and install with OpenShift","excerpt":"Download and install with OpenShift.","categories":"configeditor","slug":"download_openshift","toc":true},"relativePagePath":"/configeditor/download_openshift.md","titleType":"page","MdxNode":{"id":"47107a67-daea-5791-a1a2-26ef3b8c958b","children":[],"parent":"3aab7770-071b-5814-b83d-8c16076d3576","internal":{"content":"---\ntitle: \"Download and install with OpenShift\"\nexcerpt: \"Download and install with OpenShift.\"\ncategories: configeditor\nslug: download_openshift\ntoc: true\n---\n<!-- ---\n\ncopyright:\n  years: 2020\nlastupdated: \"2020-04-01\"\n\nkeywords: annotator clinical data, clinical data, annotation\n\nsubcollection: wh-acd\n\n--- -->\n\n<!-- # Overview -->\n\nThe following will walk through the steps necessary to set up and configure the Annotator for Clinical Data Configuration Editor running in an existing Openshift cluster.  Setup includes setting up the Configuration Editor and its required ACD sandbox instance.  This environment can be used to create, edit and preview Annotator for Clinical Data (ACD) cartridges.  The Configuration Editor can also be configured to deploy and test against other ACD instances, either running on the same cluster or elsewhere. The diagram below shows the flows in and out of the server you'll be setting up.  Ensure any firewalls are open to allow this traffic.\n\n![Configuration Editor on Openshfit](../../images/ACDCE_on_openshift.png)\n\n## Prerequisites\n\n### Hardware Prerequisites\nThe ACD Configuration Editor hardware prerequisites are in addition to those required by an installation of ACD Container Edition as a dedicated sandbox instance.  Refer to [ACD Container Edition Prerequisites](https://merative.github.io/acd-containers/installing/prereqs/).\n\n| Component | Number of worker nodes | CPU/node | Memory/node (G) |\n|:----------|------------------------|----------|-----------------|\n| ACD Configuration Editor | 3 (In addition to those for ACD Container Edition) | 8 | 32 |\n\n  For high availability, run 3 replicas of the ACD Configuration Editor on a minimum of 3 worker nodes (in addition to those for the ACD sandbox instance).  For a development or test environment, 1 or 2 replicas can be configured.\n\n### Software Prerequisites\n- OpenShift Cluster\n  - Annotator for Clinical Data Container Edition - Dedicated sandbox instance<br/>\n\n    The ACD Configuration Editor requires an installation of ACD Container Edition as a dedicated sandbox instance.  Refer to [Installing ACD](https://merative.github.io/acd-containers/installing/installing/) for requirements and installation instructions.  The ACD Configuration Editor needs to be deployed into the same namespace as the dedicated sandbox instance.<br/><br/>\n\n    Storage considerations:  For performance reasons, it is recommended that the setup of ACD and ACD Configuration Editor use a [file-based storage option](https://merative.github.io/acd-containers/installing/setup-namespace/).\n\n- Client for Installation\n  - [Helm 3](https://helm.sh/docs/intro/quickstart/)\n\n## Installing ACD Configuration Editor\n1. Copy the ACD Configuration Editor project from the [ACD Container Edition repository](https://github.com/merative/acd-containers/tree/master/ibm-wh-acd-ce).\n2. Change directory to the project:<br/>\n   `cd ibm-wh-acd-ce`\n3. Log in to the Openshift cluster on the command line:<br/>\n   `oc login ...`\n4. Switch to the same namespace that the sandbox instance of ACD is running in.<br/>\n\n   If you used the default namespace during ACD's installation, this is `ibm-wh-acd-operator-system`.<br/>\n\n    Run the command:<br/>\n   `oc project <acd namespace>`<br/>\n   - where `<acd namespace>` is the namespace where the ACD sandbox is running.\n5. Install the Concept Dictionary microservice using Helm:\n\n```\nhelm install whcs-acd-ce-cdc \\\n     ibm-wh-acd-ce/cdc/chart/cdc \\\n     --set replicas=1 \\\n     --set configurationStorage.file.volume.existingClaimName=<pvc name> \\\n     --namespace <acd namespace>\n```\n\n   - where `<acd namespace>` is the namespace where the ACD sandbox instance is running\n   - where `<pvc name>` is the persistent volume claim (PVC) the ACD sandbox instance is using\n6. Verify the Concept Dictionary microservice is running.<br/>\n   Find the `ibm-wh-acd-cdc` pod by running the command:<br/>\n   `kubectl get pods -n <acd namespace>`<br/>\n\n   Run a health check against the pod using the following command:\n   - it should list `\"serviceState\":\"OK\"`\n\n```\nkubectl exec <pod name> -c ibm-wh-acd-cdc -n <acd namespace> -- curl -sk 'https://localhost:9443/services/concept_dictionary/api/v1/status/health_check'\n```\n\n7. Install the Cartridge microservice using Helm:\n\n```\nhelm install whcs-acd-ce-crtg \\\n     ibm-wh-acd-ce/crtg/chart/crtg \\\n     --set replicas=1 \\\n     --set configurationStorage.file.volume.existingClaimName=\"<pvc name>\" \\\n     --namespace <acd namespace>\n```\n\n  - where `<acd namespace>` is the namespace where the ACD sandbox instance is running\n  - where `<pvc name>` is the persistent volume claim (PVC) the ACD sandbox instance is using\n8. Verify the Cartridge microservice is running.<br/>\n   Find the `ibm-wh-acd-crtg` pod by running the command:<br/>\n   `kubectl get pods -n <acd namespace>`<br/>\n\n   Run a health check against the pod using the following command:\n   - it should list `\"serviceState\":\"OK\"`\n\n``` \nkubectl exec <pod name> -c ibm-wh-acd-crtg -n <acd namespace> -- curl -sk 'https://localhost:9443/services/cartridge/api/v1/status/health_check'\n```\n\n## ACD Configuration Editor Authentication\n\nAccessing ACD Configuration Editor can be set up with no authentication or using an Identity Provider for authentication.\n\n### Option 1: No authentication\nIf ACD Configuration Editor is running in a restricted environment and no authentication is needed, a simple Openshift route can be configured.\n\n1. Download the yaml below and save it as `ibm-wh-acd-acd-ce-macroservice.yaml`\n\n```\napiVersion: route.openshift.io/v1\nkind: Route\nmetadata:\n  name: ibm-wh-acd-crtg\nspec:\n  host:\n  port:\n    targetPort: crtg-https-pxy\n  tls:\n    termination: passthrough\n  to:\n    kind: Service\n    name: ibm-wh-acd-crtg\n```\n\n2. Create the ACD Configuration Editor route:<br/>\n`oc create -f ibm-wh-acd-acd-ce-macroservice.yaml -n <acd namespace>`\n\n### Option 2: Identity Provider authentication\nThere are multiple Identity Providers for providing an authentication layer for ACD Configuration Editor (Azure Active Directory, Google, IBMId, etc). This section will discuss the configuration using [OIDC](https://en.wikipedia.org/wiki/OpenID) with [Openshift OAuth 2.0 Proxy](https://github.com/openshift/oauth-proxy).\n\n1. Create a project/namespace for the proxy and set the current namespace to it. For the remainder of this document, we will use the example `ibm-wh-acd-ce-oauth`.\n   - `oc create namespace ibm-wh-acd-ce-oauth`\n   - `oc project ibm-wh-acd-ce-oauth`\n\n2. Download the yaml below and save it as `ibm-wh-acd-ce-oauth.yaml`\n\n```\nkind: List\napiVersion: v1\nitems:\n# Create a secure connection to the proxy via a route\n- apiVersion: route.openshift.io/v1\n  kind: Route\n  metadata:\n    name: proxy\n  spec:\n    to:\n      kind: Service\n      name: proxy\n    tls:\n      termination: Reencrypt\n- apiVersion: v1\n  kind: Service\n  metadata:\n    name: proxy\n    annotations:\n      service.alpha.openshift.io/serving-cert-secret-name: proxy-tls\n  spec:\n    ports:\n    - name: public-https\n      port: 443\n      targetPort: 8443\n    selector:\n      app: proxy\n# Launch a proxy as a deployment\n- apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: proxy\n  spec:\n    replicas: 1\n    selector:\n      matchLabels:\n        app: proxy\n    template:\n      metadata:\n        labels:\n          app: proxy\n      spec:\n        containers:\n        - name: oauth-proxy\n          image: quay.io/oauth2-proxy/oauth2-proxy\n          imagePullPolicy: IfNotPresent\n          ports:\n          - containerPort: 8443\n            name: public-https\n          args:\n          - --client-id=<client id>\n          - --client-secret=<client secret>\n          - --cookie-secret=<cookie secret>\n          - --cookie-secure=true\n          - --email-domain=*\n          - --https-address=:8443\n          - --oidc-issuer-url=<oidc issuer url>\n          - --pass-host-header=true\n          - --pass-user-headers=true\n          - --provider=oidc\n          - --provider-display-name=\"ACD OIDC Provider\"\n          - --redirect-url=https://<hostname>/oauth2/callback\n          - --request-logging=true\n          - --set-authorization-header=true\n          - --set-xauthrequest=true\n          - --show-debug-on-error=true\n          - --skip-auth-strip-headers=true\n          - --skip-provider-button=true\n          - --ssl-upstream-insecure-skip-verify=true\n          - --upstream=https://ibm-wh-acd-crtg.ibm-wh-acd-operator-system.svc:443/\n          - --tls-cert-file=/etc/tls/private/tls.crt\n          - --tls-key-file=/etc/tls/private/tls.key\n          volumeMounts:\n          - mountPath: /etc/tls/private\n            name: proxy-tls\n        volumes:\n        - name: proxy-tls\n          secret:\n            secretName: proxy-tls\n```\n\n  - where `<client id>` is the OAuth client id\n  - where `<client secret>` is the OAuth client secret\n  - where `<cookie secret>` is the generated cookie secret\n  - where `<oidc issuer url>` is the OIDC issuer URL, e.g. `https://sts.windows.net/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/` for Azure Active Directory\n  - where `<hostname`> is the OAuth proxy hostname, e.g. `proxy-ibm-wh-acd-ce-oauth.xxx.us-xxxx.containers.appdomain.cloud` for IBM Cloud\n\n3.  Create the proxy's deployment, proxy's service, and proxy's route:<br/>\n  `oc create -f ibm-wh-acd-ce-oauth.yaml`<br/>\n\n   More options and details for the proxy are available at [OpenShift OAuth Proxy](https://github.com/openshift/oauth-proxy#openshift-oauth-proxy).  Information on troubleshooting the OAuth Proxy is found at [Troubleshooting the OAuth Proxy](/troubleshooting/troubleshooting-the-oauth-proxy/).  More details and options such as secret generation and cookie expiration are defined in the base [OAuth proxy](https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/overview/) docs.\n\n### Verification\n\nGo to the following URL to verify authentication and the proxy route:<br/>\n`https://<hostname>/services/cartridge/cartridge-main.html`<br/>\n\nYou may get an error about the self-signed certificate in the browser, but you can use advanced option to continue to the site.  In Google Chrome, if there is no button to proceed, click on the advanced warning text and type `thisisunsafe` (all one word lower-case--type it after clicking on the warning) and it should proceed.  This is only needed the first time in.  To fix this, add a trusted CA-issued certificate to the Apache HTTP server.\n\nAfter you are in, you are at the main ACD Configuration Editor catalog page. Initially, there are no default cartridges so your list will be empty.  You can install the base [Clinical Insights](https://github.com/merative/acd-cartridges) cartridge via an import and extend that cartridge or create your own new cartridge.  In the upper right corner of the page, click the mortar board tutorial link to see Introductory videos and click the \"?\" icon to view the Getting Started Guide.  \n\nPeriodically, refer to this page for updates to the Configuration Editor packages and see below for update instructions.\n\n### Additional Configurations\n\nThe ACD Configuration Editor can be configured to put a 'Logout' button on the user interface. This button can clear cookies and redirect to an authentication URL to perform logout. In order to configure the ability to logout of your instance, you can configure certain parameters under the Cartridge service in the `ibm-wh-acd-ce/crtg/chart/crtg/values.yaml` file.<br/>\n\nCustom properties include:\n- `com_ibm_watson_health_car_auth_enable_logout` Set this property as true to enable logout.\n- `com_ibm_watson_health_car_auth_logout_url` Set this property to the URL your authentication method uses to perform logout, if applicable.\n   - Note:  Your \"url\" property must be encoded to ensure it is correctly pulled into the ACD Configuration Editor. An easy way to perform the encoding is with the Javascript method `encodeURIComponent` or with [https://www.urlencoder.org/](https://www.urlencoder.org/).\n   - Your URL will likely need a redirect URL, in which case we recommend redirecting to the Configuration Editor main page, which is at `your-acd-config-editor-site/services/cartridge/cartridge-main.html`.\n- `com_ibm_watson_health_car_auth_logout_cookies` Set this property to the cookies your authentication method uses to store session information. If there are multiple cookies, comma-separate them. These will be cleared in the logout process.\n \n## Deploying to Custom ACD Configuration Editor Environments (optional)\n\nACD Configuration Editor provides the ability to deploy published cartridges to ACD instances in production environments.  To configure additional custom environments, the following files must be modified and the Cartridge microservice must be redeployed using Helm (see Installing ACD Configuration Editor instructions above).\n\n1. `ibm-wh-acd-ce/crtg/chart/crtg/rev-proxy.conf`\n\n```\nlocation /<identifier>/ {\n    resolver 8.8.8.8;\n    proxy_set_header Authorization $http_authorization;\n    set $prod_dev \"<hostname>\";\n    proxy_set_header Host $prod_dev;\n    proxy_ssl_server_name on;\n    if ($request_uri ~* \"/<identifier>(/.*$)\") {\n        set  $path_remainder $1;\n    }\n    proxy_pass https://$prod_dev/wh-acd$path_remainder;\n}\n```\n  - where `<identifier>` is the identifier of the custom ACD instance, e.g. `custom-acd`\n  - where `<hostname>` is the hostname of the custom ACD instance, e.g. `us-south.wh-acd.cloud.ibm.com`\n\n2. `ibm-wh-acd-ce/crtg/chart/crtg/values.yaml`\n\n```\n - name: \"com_ibm_watson_health_car_acd_host_3_label\"\n    value: \"Annotator for Clinical Data - <identifier>\"\n  - name: \"com_ibm_watson_health_car_acd_host_3_url\"\n    value: \"https://<hostname>/wh-acd/api\"\n  - name: \"com_ibm_watson_health_car_acd_host_3_proxy\"\n    value: \"<identifier>\"\n  - name: \"com_ibm_watson_health_car_acd_host_3_auth\"\n    value: \"APIKey\"\n  - name: \"com_ibm_watson_health_car_acd_host_3_phi\"\n    value: \"true\"\n```\n\n  - where `<identifier>` is the identifier of the custom ACD instance, e.g. `custom-acd`\n  - where `<hostname>` is the hostname of the custom ACD instance, e.g. `us-south.wh-acd.cloud.ibm.com`\n\nACD Hosts must be indexed in the properties file using `com_ibm_watson_health_car_acd_host_{index}` as the beginning of their property name. The index must start at \"3\". The properties are:\n- `_label` which is the name for the host that will be shown in the Configuration Editor\n- `_url` which is what will be shown in the host description in the Configuration Editor\n- `_proxy` which is the proxy you have configured in your `ibm-wh-acd-ce/crtg/chart/crtg/rev-proxy.conf` file mentioned in Step 1 in this section \n- `_phi` which is either true or false based on whether this ACD Host can support protected health information\n- `_auth` which specifies the type of authentication the host requires.  The three possible authentication types are:\n   - APIKey: Used for cloud hosts. It will prompt the user to enter their API Key, and then use the identity server specified in the properties file in the field `com_ibm_watson_health_car_identity_server` (default is `https://iam.cloud.ibm.com/identity/token`) in order to request a bearer token using the API Key the user entered.\n   - Bearer: Used for an ACD Container Edition host, and will prompt the user for their Bearer token to the ACD Container Edition and expire every 24 hours.\n   - Leaving the field blank: Used for no authentication if the host does not require any authentication.\n\n## Backing up Your Data\n\nAll configuration data such as cartridges, flows, dictionaries, filters, etc., are stored in the storage set up as part of the ACD [prerequisites](/configeditor/download_openshift/#prerequisites). The recommendation is to use file-based storage via a persistent volume claim (PVC). Backup of this storage is implementation-specific. It is recommended to have at least daily backups in case a restore is needed.\n\n## Updating ACD Configuration Editor\n\nTo update to a newer version of the ACD Configuration Editor follow these steps:\n\n1. Back up any customizations in:\n  - `ibm-wh-acd-ce/crtg/chart/crtg/rev-proxy.conf`\n  - `ibm-wh-acd-ce/crtg/chart/crtg/values.yaml`\n2. Download the latest project and unpack it as above.\n3. Delete the existing Helm deployments:\n  - `helm delete whcs-acd-ce-crtg`\n  - `helm delete whcs-acd-ce-cdc`\n4. Merge in any customizations to the new project files.\n\n\n## Notices\n\nThe Configuration Editor is Java compatible.\n\n![Java Compatible](../../images/Java.png)\n\n\n[View Program Terms](https://www14.software.ibm.com/cgi-bin/weblap/lap.pl?li_formnum=L-KMNL-BTV7T4)\n\n","type":"Mdx","contentDigest":"7036222addc64bfb72f345abc9fd9f25","owner":"gatsby-plugin-mdx","counter":214},"frontmatter":{"title":"Download and install with OpenShift","excerpt":"Download and install with OpenShift.","categories":"configeditor","slug":"download_openshift","toc":true},"excerpt":"Download and install with OpenShift.","exports":{},"rawBody":"---\ntitle: \"Download and install with OpenShift\"\nexcerpt: \"Download and install with OpenShift.\"\ncategories: configeditor\nslug: download_openshift\ntoc: true\n---\n<!-- ---\n\ncopyright:\n  years: 2020\nlastupdated: \"2020-04-01\"\n\nkeywords: annotator clinical data, clinical data, annotation\n\nsubcollection: wh-acd\n\n--- -->\n\n<!-- # Overview -->\n\nThe following will walk through the steps necessary to set up and configure the Annotator for Clinical Data Configuration Editor running in an existing Openshift cluster.  Setup includes setting up the Configuration Editor and its required ACD sandbox instance.  This environment can be used to create, edit and preview Annotator for Clinical Data (ACD) cartridges.  The Configuration Editor can also be configured to deploy and test against other ACD instances, either running on the same cluster or elsewhere. The diagram below shows the flows in and out of the server you'll be setting up.  Ensure any firewalls are open to allow this traffic.\n\n![Configuration Editor on Openshfit](../../images/ACDCE_on_openshift.png)\n\n## Prerequisites\n\n### Hardware Prerequisites\nThe ACD Configuration Editor hardware prerequisites are in addition to those required by an installation of ACD Container Edition as a dedicated sandbox instance.  Refer to [ACD Container Edition Prerequisites](https://merative.github.io/acd-containers/installing/prereqs/).\n\n| Component | Number of worker nodes | CPU/node | Memory/node (G) |\n|:----------|------------------------|----------|-----------------|\n| ACD Configuration Editor | 3 (In addition to those for ACD Container Edition) | 8 | 32 |\n\n  For high availability, run 3 replicas of the ACD Configuration Editor on a minimum of 3 worker nodes (in addition to those for the ACD sandbox instance).  For a development or test environment, 1 or 2 replicas can be configured.\n\n### Software Prerequisites\n- OpenShift Cluster\n  - Annotator for Clinical Data Container Edition - Dedicated sandbox instance<br/>\n\n    The ACD Configuration Editor requires an installation of ACD Container Edition as a dedicated sandbox instance.  Refer to [Installing ACD](https://merative.github.io/acd-containers/installing/installing/) for requirements and installation instructions.  The ACD Configuration Editor needs to be deployed into the same namespace as the dedicated sandbox instance.<br/><br/>\n\n    Storage considerations:  For performance reasons, it is recommended that the setup of ACD and ACD Configuration Editor use a [file-based storage option](https://merative.github.io/acd-containers/installing/setup-namespace/).\n\n- Client for Installation\n  - [Helm 3](https://helm.sh/docs/intro/quickstart/)\n\n## Installing ACD Configuration Editor\n1. Copy the ACD Configuration Editor project from the [ACD Container Edition repository](https://github.com/merative/acd-containers/tree/master/ibm-wh-acd-ce).\n2. Change directory to the project:<br/>\n   `cd ibm-wh-acd-ce`\n3. Log in to the Openshift cluster on the command line:<br/>\n   `oc login ...`\n4. Switch to the same namespace that the sandbox instance of ACD is running in.<br/>\n\n   If you used the default namespace during ACD's installation, this is `ibm-wh-acd-operator-system`.<br/>\n\n    Run the command:<br/>\n   `oc project <acd namespace>`<br/>\n   - where `<acd namespace>` is the namespace where the ACD sandbox is running.\n5. Install the Concept Dictionary microservice using Helm:\n\n```\nhelm install whcs-acd-ce-cdc \\\n     ibm-wh-acd-ce/cdc/chart/cdc \\\n     --set replicas=1 \\\n     --set configurationStorage.file.volume.existingClaimName=<pvc name> \\\n     --namespace <acd namespace>\n```\n\n   - where `<acd namespace>` is the namespace where the ACD sandbox instance is running\n   - where `<pvc name>` is the persistent volume claim (PVC) the ACD sandbox instance is using\n6. Verify the Concept Dictionary microservice is running.<br/>\n   Find the `ibm-wh-acd-cdc` pod by running the command:<br/>\n   `kubectl get pods -n <acd namespace>`<br/>\n\n   Run a health check against the pod using the following command:\n   - it should list `\"serviceState\":\"OK\"`\n\n```\nkubectl exec <pod name> -c ibm-wh-acd-cdc -n <acd namespace> -- curl -sk 'https://localhost:9443/services/concept_dictionary/api/v1/status/health_check'\n```\n\n7. Install the Cartridge microservice using Helm:\n\n```\nhelm install whcs-acd-ce-crtg \\\n     ibm-wh-acd-ce/crtg/chart/crtg \\\n     --set replicas=1 \\\n     --set configurationStorage.file.volume.existingClaimName=\"<pvc name>\" \\\n     --namespace <acd namespace>\n```\n\n  - where `<acd namespace>` is the namespace where the ACD sandbox instance is running\n  - where `<pvc name>` is the persistent volume claim (PVC) the ACD sandbox instance is using\n8. Verify the Cartridge microservice is running.<br/>\n   Find the `ibm-wh-acd-crtg` pod by running the command:<br/>\n   `kubectl get pods -n <acd namespace>`<br/>\n\n   Run a health check against the pod using the following command:\n   - it should list `\"serviceState\":\"OK\"`\n\n``` \nkubectl exec <pod name> -c ibm-wh-acd-crtg -n <acd namespace> -- curl -sk 'https://localhost:9443/services/cartridge/api/v1/status/health_check'\n```\n\n## ACD Configuration Editor Authentication\n\nAccessing ACD Configuration Editor can be set up with no authentication or using an Identity Provider for authentication.\n\n### Option 1: No authentication\nIf ACD Configuration Editor is running in a restricted environment and no authentication is needed, a simple Openshift route can be configured.\n\n1. Download the yaml below and save it as `ibm-wh-acd-acd-ce-macroservice.yaml`\n\n```\napiVersion: route.openshift.io/v1\nkind: Route\nmetadata:\n  name: ibm-wh-acd-crtg\nspec:\n  host:\n  port:\n    targetPort: crtg-https-pxy\n  tls:\n    termination: passthrough\n  to:\n    kind: Service\n    name: ibm-wh-acd-crtg\n```\n\n2. Create the ACD Configuration Editor route:<br/>\n`oc create -f ibm-wh-acd-acd-ce-macroservice.yaml -n <acd namespace>`\n\n### Option 2: Identity Provider authentication\nThere are multiple Identity Providers for providing an authentication layer for ACD Configuration Editor (Azure Active Directory, Google, IBMId, etc). This section will discuss the configuration using [OIDC](https://en.wikipedia.org/wiki/OpenID) with [Openshift OAuth 2.0 Proxy](https://github.com/openshift/oauth-proxy).\n\n1. Create a project/namespace for the proxy and set the current namespace to it. For the remainder of this document, we will use the example `ibm-wh-acd-ce-oauth`.\n   - `oc create namespace ibm-wh-acd-ce-oauth`\n   - `oc project ibm-wh-acd-ce-oauth`\n\n2. Download the yaml below and save it as `ibm-wh-acd-ce-oauth.yaml`\n\n```\nkind: List\napiVersion: v1\nitems:\n# Create a secure connection to the proxy via a route\n- apiVersion: route.openshift.io/v1\n  kind: Route\n  metadata:\n    name: proxy\n  spec:\n    to:\n      kind: Service\n      name: proxy\n    tls:\n      termination: Reencrypt\n- apiVersion: v1\n  kind: Service\n  metadata:\n    name: proxy\n    annotations:\n      service.alpha.openshift.io/serving-cert-secret-name: proxy-tls\n  spec:\n    ports:\n    - name: public-https\n      port: 443\n      targetPort: 8443\n    selector:\n      app: proxy\n# Launch a proxy as a deployment\n- apiVersion: apps/v1\n  kind: Deployment\n  metadata:\n    name: proxy\n  spec:\n    replicas: 1\n    selector:\n      matchLabels:\n        app: proxy\n    template:\n      metadata:\n        labels:\n          app: proxy\n      spec:\n        containers:\n        - name: oauth-proxy\n          image: quay.io/oauth2-proxy/oauth2-proxy\n          imagePullPolicy: IfNotPresent\n          ports:\n          - containerPort: 8443\n            name: public-https\n          args:\n          - --client-id=<client id>\n          - --client-secret=<client secret>\n          - --cookie-secret=<cookie secret>\n          - --cookie-secure=true\n          - --email-domain=*\n          - --https-address=:8443\n          - --oidc-issuer-url=<oidc issuer url>\n          - --pass-host-header=true\n          - --pass-user-headers=true\n          - --provider=oidc\n          - --provider-display-name=\"ACD OIDC Provider\"\n          - --redirect-url=https://<hostname>/oauth2/callback\n          - --request-logging=true\n          - --set-authorization-header=true\n          - --set-xauthrequest=true\n          - --show-debug-on-error=true\n          - --skip-auth-strip-headers=true\n          - --skip-provider-button=true\n          - --ssl-upstream-insecure-skip-verify=true\n          - --upstream=https://ibm-wh-acd-crtg.ibm-wh-acd-operator-system.svc:443/\n          - --tls-cert-file=/etc/tls/private/tls.crt\n          - --tls-key-file=/etc/tls/private/tls.key\n          volumeMounts:\n          - mountPath: /etc/tls/private\n            name: proxy-tls\n        volumes:\n        - name: proxy-tls\n          secret:\n            secretName: proxy-tls\n```\n\n  - where `<client id>` is the OAuth client id\n  - where `<client secret>` is the OAuth client secret\n  - where `<cookie secret>` is the generated cookie secret\n  - where `<oidc issuer url>` is the OIDC issuer URL, e.g. `https://sts.windows.net/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/` for Azure Active Directory\n  - where `<hostname`> is the OAuth proxy hostname, e.g. `proxy-ibm-wh-acd-ce-oauth.xxx.us-xxxx.containers.appdomain.cloud` for IBM Cloud\n\n3.  Create the proxy's deployment, proxy's service, and proxy's route:<br/>\n  `oc create -f ibm-wh-acd-ce-oauth.yaml`<br/>\n\n   More options and details for the proxy are available at [OpenShift OAuth Proxy](https://github.com/openshift/oauth-proxy#openshift-oauth-proxy).  Information on troubleshooting the OAuth Proxy is found at [Troubleshooting the OAuth Proxy](/troubleshooting/troubleshooting-the-oauth-proxy/).  More details and options such as secret generation and cookie expiration are defined in the base [OAuth proxy](https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/overview/) docs.\n\n### Verification\n\nGo to the following URL to verify authentication and the proxy route:<br/>\n`https://<hostname>/services/cartridge/cartridge-main.html`<br/>\n\nYou may get an error about the self-signed certificate in the browser, but you can use advanced option to continue to the site.  In Google Chrome, if there is no button to proceed, click on the advanced warning text and type `thisisunsafe` (all one word lower-case--type it after clicking on the warning) and it should proceed.  This is only needed the first time in.  To fix this, add a trusted CA-issued certificate to the Apache HTTP server.\n\nAfter you are in, you are at the main ACD Configuration Editor catalog page. Initially, there are no default cartridges so your list will be empty.  You can install the base [Clinical Insights](https://github.com/merative/acd-cartridges) cartridge via an import and extend that cartridge or create your own new cartridge.  In the upper right corner of the page, click the mortar board tutorial link to see Introductory videos and click the \"?\" icon to view the Getting Started Guide.  \n\nPeriodically, refer to this page for updates to the Configuration Editor packages and see below for update instructions.\n\n### Additional Configurations\n\nThe ACD Configuration Editor can be configured to put a 'Logout' button on the user interface. This button can clear cookies and redirect to an authentication URL to perform logout. In order to configure the ability to logout of your instance, you can configure certain parameters under the Cartridge service in the `ibm-wh-acd-ce/crtg/chart/crtg/values.yaml` file.<br/>\n\nCustom properties include:\n- `com_ibm_watson_health_car_auth_enable_logout` Set this property as true to enable logout.\n- `com_ibm_watson_health_car_auth_logout_url` Set this property to the URL your authentication method uses to perform logout, if applicable.\n   - Note:  Your \"url\" property must be encoded to ensure it is correctly pulled into the ACD Configuration Editor. An easy way to perform the encoding is with the Javascript method `encodeURIComponent` or with [https://www.urlencoder.org/](https://www.urlencoder.org/).\n   - Your URL will likely need a redirect URL, in which case we recommend redirecting to the Configuration Editor main page, which is at `your-acd-config-editor-site/services/cartridge/cartridge-main.html`.\n- `com_ibm_watson_health_car_auth_logout_cookies` Set this property to the cookies your authentication method uses to store session information. If there are multiple cookies, comma-separate them. These will be cleared in the logout process.\n \n## Deploying to Custom ACD Configuration Editor Environments (optional)\n\nACD Configuration Editor provides the ability to deploy published cartridges to ACD instances in production environments.  To configure additional custom environments, the following files must be modified and the Cartridge microservice must be redeployed using Helm (see Installing ACD Configuration Editor instructions above).\n\n1. `ibm-wh-acd-ce/crtg/chart/crtg/rev-proxy.conf`\n\n```\nlocation /<identifier>/ {\n    resolver 8.8.8.8;\n    proxy_set_header Authorization $http_authorization;\n    set $prod_dev \"<hostname>\";\n    proxy_set_header Host $prod_dev;\n    proxy_ssl_server_name on;\n    if ($request_uri ~* \"/<identifier>(/.*$)\") {\n        set  $path_remainder $1;\n    }\n    proxy_pass https://$prod_dev/wh-acd$path_remainder;\n}\n```\n  - where `<identifier>` is the identifier of the custom ACD instance, e.g. `custom-acd`\n  - where `<hostname>` is the hostname of the custom ACD instance, e.g. `us-south.wh-acd.cloud.ibm.com`\n\n2. `ibm-wh-acd-ce/crtg/chart/crtg/values.yaml`\n\n```\n - name: \"com_ibm_watson_health_car_acd_host_3_label\"\n    value: \"Annotator for Clinical Data - <identifier>\"\n  - name: \"com_ibm_watson_health_car_acd_host_3_url\"\n    value: \"https://<hostname>/wh-acd/api\"\n  - name: \"com_ibm_watson_health_car_acd_host_3_proxy\"\n    value: \"<identifier>\"\n  - name: \"com_ibm_watson_health_car_acd_host_3_auth\"\n    value: \"APIKey\"\n  - name: \"com_ibm_watson_health_car_acd_host_3_phi\"\n    value: \"true\"\n```\n\n  - where `<identifier>` is the identifier of the custom ACD instance, e.g. `custom-acd`\n  - where `<hostname>` is the hostname of the custom ACD instance, e.g. `us-south.wh-acd.cloud.ibm.com`\n\nACD Hosts must be indexed in the properties file using `com_ibm_watson_health_car_acd_host_{index}` as the beginning of their property name. The index must start at \"3\". The properties are:\n- `_label` which is the name for the host that will be shown in the Configuration Editor\n- `_url` which is what will be shown in the host description in the Configuration Editor\n- `_proxy` which is the proxy you have configured in your `ibm-wh-acd-ce/crtg/chart/crtg/rev-proxy.conf` file mentioned in Step 1 in this section \n- `_phi` which is either true or false based on whether this ACD Host can support protected health information\n- `_auth` which specifies the type of authentication the host requires.  The three possible authentication types are:\n   - APIKey: Used for cloud hosts. It will prompt the user to enter their API Key, and then use the identity server specified in the properties file in the field `com_ibm_watson_health_car_identity_server` (default is `https://iam.cloud.ibm.com/identity/token`) in order to request a bearer token using the API Key the user entered.\n   - Bearer: Used for an ACD Container Edition host, and will prompt the user for their Bearer token to the ACD Container Edition and expire every 24 hours.\n   - Leaving the field blank: Used for no authentication if the host does not require any authentication.\n\n## Backing up Your Data\n\nAll configuration data such as cartridges, flows, dictionaries, filters, etc., are stored in the storage set up as part of the ACD [prerequisites](/configeditor/download_openshift/#prerequisites). The recommendation is to use file-based storage via a persistent volume claim (PVC). Backup of this storage is implementation-specific. It is recommended to have at least daily backups in case a restore is needed.\n\n## Updating ACD Configuration Editor\n\nTo update to a newer version of the ACD Configuration Editor follow these steps:\n\n1. Back up any customizations in:\n  - `ibm-wh-acd-ce/crtg/chart/crtg/rev-proxy.conf`\n  - `ibm-wh-acd-ce/crtg/chart/crtg/values.yaml`\n2. Download the latest project and unpack it as above.\n3. Delete the existing Helm deployments:\n  - `helm delete whcs-acd-ce-crtg`\n  - `helm delete whcs-acd-ce-cdc`\n4. Merge in any customizations to the new project files.\n\n\n## Notices\n\nThe Configuration Editor is Java compatible.\n\n![Java Compatible](../../images/Java.png)\n\n\n[View Program Terms](https://www14.software.ibm.com/cgi-bin/weblap/lap.pl?li_formnum=L-KMNL-BTV7T4)\n\n","fileAbsolutePath":"/home/runner/work/acd-containers/acd-containers/src/pages/configeditor/download_openshift.md"}}},"staticQueryHashes":["1364590287","137577622","2102389209","2456312558","2610115429","2746626797","3037994772","768070550"]}